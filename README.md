
# Replication codes - "Aggregate effects of firing costs with endogenous firm productivity growth"

This code is written to make use of parallel programming (`OpenMP`) and `GNUplot` to generate figures. `OpenMP` is included in most Fortran distributions, and `GNUplot` can be freely downloaded [here](https://sourceforge.net/projects/gnuplot/files/gnuplot/5.2.7/). If you don't want to download it, you will need to load the data from a number of `.txt` files (located in the folder `~/results`) into Excel, Matlab, etc, to generate the figures.

Please, if you find any error or have a suggestion, do not hesitate to  [contact](mailto:bpetit@cunef.edu) me.

## Content

| File/folder | Description |
|:------------|:-------------|
| `main.f90` | This file controls the solution of the model. |
| `calibration.f90` | This file is a module containing the functions and subroutines required to calibrate the parameters of the model. |
| `experiment.f90` | This file is a module containing two important subroutines: one controlling the experiments, and another one controlling the sensitivity analysis.
| `firmsproblem.f90` | This module solves the firm's problem, compute the invariant distribution of firms, and calculate the moments used to calibrate the model.
| `params.f90` | This module contains all the global variables used throughtout the paper, as well as a number of simple functions and subroutines to print results and generate graphs.
| `toolkit.f90` | This file contains a number of general-purpose functions and subroutines such as minimization algorithms, algebra, etc.
| `~/compiledfiles` |  This folder stores the figures generated by the program, and contains a number of `.gnu` files with instructions to generate graphs in `GNUplot` located in the subfolder `~/figures/code`
| `~/results` | his folder stores `.txt` files with different results from the model, some of which are then used to generate graphs
| `~/txtfiles` | This folder contains two `.txt` files: (i) `params.txt` which contains the parameter values, and  (ii) `moments.txt`containing the empirical moments used for calibration.


**IMPORTANT**: It is important that you keep the `.f90` files and the four folders in the same directory. The first thing you have to do to compile and run these codes is to enter your directory in the variable `path`, in `params.f90`, since all the I/O files are written relative to the specified path.

## Compilation

To compile the codes, you first need to set the current directory:
```
cd /Users/(...)/code/
```
and then use the following command:
```
gfortran -fopenmp -O3 -ffixed-line-length-132 -J $(pwd)/compiledfiles toolkit.f90 params.f90 firmsproblem.f90 calibration.f90 experiment.f90 main.f90 -o model
```
This command includes four flags. First, compiler to link the executable with `OpenMP` for parallel programing, using the flag `-fopenmp`. Second, the flag `-O3`, makes the code faster, although it slows down compilation a bit. Third, the flag `-ffixed-line-length-132` prevents line truncation (I set the line length to 132). Finally, and in order to keep the working directory clean, the flag `$(pwd)/compiledfiles` forces the compiler to store the `.mod` files in the folder `~/compiledfiles` (this will only work is you have defined your current directory before).

If you are using the Intel compiler, the command is:
```
ifort /openmp /O3 /object:%cd%\compiledfiles\ /module:%cd%\compiledfiles\ toolkit.f90 params.f90 firmsproblem.f90 calibration.f90 experiment.f90 main.f90 -o model
```  
  
```
What do you want to do?<br>
  [ 0 ] Solve the model for given parameters (params.txt)
        -> take value of theta from params.txt & find wage
  [ 1 ] Solve the model for given parameters (params.txt)
        -> assume wage rate = 1, and compute the theta
  [ 2 ] Run experiment
  [ 3 ] Calibrate the parameters
  [ 4 ] Run sensitivity analysis
```



